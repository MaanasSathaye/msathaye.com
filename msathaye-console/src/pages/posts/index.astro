---
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getCollection } from 'astro:content'

const posts = (await getCollection('posts')).sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
)

const topics = [
  { name: 'All Topics', slug: '' },
  { name: 'Engineering', slug: 'engineering' },
  { name: 'Sports Performance and Nutrition', slug: 'sports' },
]
---

<BaseLayout title="posts">
  <div class="flex gap-3 flex-wrap mb-8">
    {
      topics.map((t) => (
        <button
          class:list={[
            'topic-btn px-4 py-2 rounded text-sm transition-colors cursor-pointer',
            t.slug === '' ? 'bg-purple-deep text-white font-semibold' : 'bg-purple-muted/30 hover:bg-purple-muted/50',
          ]}
          data-topic={t.slug}
        >
          {t.name}
        </button>
      ))
    }
  </div>

  {
    posts.map((post) => (
      <div
        class="post-entry flex items-baseline gap-3 my-3"
        data-topic={post.data.topic}
      >
        <time class="text-stone-800 text-sm shrink-0">
          {new Date(post.data.date).toISOString().split('T')[0]}
        </time>
        <span class="text-stone-400">-</span>
        <a
          href={`/posts/${post.id}/`}
          class="text-blue-700 hover:underline text-lg"
        >
          {post.data.title}
        </a>
      </div>
    ))
  }

  <script>
    const buttons = document.querySelectorAll('.topic-btn')
    const entries = document.querySelectorAll('.post-entry')

    buttons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const topic = (btn as HTMLElement).dataset.topic

        buttons.forEach((b) => {
          b.classList.remove('bg-purple-deep', 'text-white', 'font-semibold')
          b.classList.add('bg-purple-muted/30')
        })
        btn.classList.remove('bg-purple-muted/30')
        btn.classList.add('bg-purple-deep', 'text-white', 'font-semibold')

        entries.forEach((entry) => {
          const el = entry as HTMLElement
          el.style.display =
            !topic || el.dataset.topic === topic ? '' : 'none'
        })
      })
    })
  </script>
</BaseLayout>
